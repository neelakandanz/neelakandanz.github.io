<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aadu Puli Aattam (Goats and Tigers) - Neelakandan</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap');

        :root {
            --color-bg: #f8fafc;
            --color-board: #334155;
            --color-line: #94a3b8;
            --color-tiger: #ea580c;
            --color-goat: #ffffff;
            --color-highlight: #22c55e;
            --font-main: 'Outfit', sans-serif;
            --header-height: 60px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--color-bg);
            font-family: var(--font-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: #1e293b;
        }

        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            z-index: 50;
        }

        .header-title {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }

        h1 {
            font-size: 1.25rem;
            margin: 0;
            color: #0f172a;
        }

        .header-subtitle {
            font-size: 0.7rem;
            color: #64748b;
            margin: 0;
        }

        .main-content {
            margin-top: calc(var(--header-height) + 1rem);
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            justify-content: center;
            gap: 2rem;
            padding: 1rem 2rem;
            width: 100%;
            height: calc(100vh - var(--header-height) - 2rem);
        }

        #game-container {
            position: relative;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            overflow: hidden;
            background: var(--color-board);
            flex-shrink: 0;
        }

        canvas {
            display: block;
            cursor: pointer;
        }

        #ui-panel {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            align-items: stretch;
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            min-width: 180px;
            height: fit-content;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
                align-items: center;
                height: auto;
            }

            #ui-panel {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                min-width: auto;
                width: 100%;
                max-width: 500px;
            }
        }

        .status-box {
            text-align: center;
            padding: 0.5rem 0;
        }

        .status-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #64748b;
            margin-bottom: 0.25rem;
        }

        .status-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0f172a;
        }

        #ui-panel .btn {
            width: 100%;
        }

        @media (max-width: 768px) {
            #ui-panel .btn {
                width: auto;
            }
        }

        #turn-indicator {
            padding: 0.5rem 1rem;
            border-radius: 99px;
            background: #e2e8f0;
            font-weight: 600;
            color: #475569;
        }

        .turn-tiger {
            background: #ffedd5 !important;
            color: #9a3412 !important;
        }

        .turn-goat {
            background: #dcfce7 !important;
            color: #166534 !important;
        }

        .btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid #cbd5e1;
            color: #475569;
        }

        .btn-outline:hover {
            background: #f1f5f9;
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            flex-direction: column;
        }

        .modal-card {
            background: white;
            padding: 2.5rem;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .modal-title {
            font-size: 2rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 1rem;
        }

        .modal-text {
            color: #64748b;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .mode-btn {
            display: block;
            width: 100%;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            position: relative;
        }

        .mode-btn:hover {
            border-color: #3b82f6;
            background: #f8fafc;
        }

        .mode-btn.primary {
            background: #3b82f6;
            border-color: #3b82f6;
            color: white;
        }

        .mode-btn.primary:hover {
            background: #2563eb;
        }

        .mode-desc {
            font-size: 0.85rem;
            font-weight: 400;
            display: block;
            opacity: 0.8;
            margin-top: 0.25rem;
        }

        /* Rules Modal */
        #rules-content {
            text-align: left;
            margin-bottom: 1.5rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .lang-switch {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            justify-content: center;
        }

        .lang-btn {
            padding: 0.25rem 0.75rem;
            font-size: 0.8rem;
            border-radius: 99px;
            border: 1px solid #cbd5e1;
            background: transparent;
            cursor: pointer;
        }

        .lang-btn.active {
            background: #0f172a;
            color: white;
            border-color: #0f172a;
        }

        #game-over-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.9);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 10;
        }

        #winner-text {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
    </style>
</head>

<body>

    <header>
        <a href="../../index.html" class="btn btn-outline">← Back</a>
        <div class="header-title">
            <h1>Aadu Puli Aattam</h1>
            <p class="header-subtitle">Goats (Aadu) vs Tigers (Puli)</p>
        </div>
        <div style="width: 80px;"></div> <!-- Spacer for centering -->
    </header>

    <div class="main-content">
        <div id="game-container">
            <canvas id="gameCanvas"></canvas>
            <div id="game-over-modal">
                <div id="winner-text">Goats Win!</div>
                <button class="btn" onclick="resetGame()">Play Again</button>
            </div>
        </div>

        <div id="ui-panel">
            <div class="status-box">
                <div class="status-label">Goats Left</div>
                <div class="status-value" id="goats-count">15</div>
            </div>
            <div class="status-box">
                <div class="status-label">Dead Goats</div>
                <div class="status-value" id="dead-goats">0</div>
            </div>
            <div id="turn-indicator" class="turn-tiger">Tiger's Turn</div>
            <button class="btn btn-outline" onclick="openRules()">Rules / விதிமுறைகள்</button>
            <button class="btn btn-outline" onclick="location.reload()">Exit</button>
        </div>
    </div>

    <!-- Start Screen Modal -->
    <div id="start-modal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-title">Welcome / வணக்கம்</div>
            <p class="modal-text">Select a mode to begin.<br>விளையாட்டு முறையைத் தேர்ந்தெடுக்கவும்.</p>

            <button class="mode-btn primary" onclick="startGame('BEGINNER')">
                Beginner (Demo)
                <span class="mode-desc">Watch how to play with a short demo.<br>விளையாடுவது எப்படி என்று
                    கற்றுக்கொள்ளுங்கள்.</span>
            </button>

            <button class="mode-btn" onclick="startGame('EXPERT')">
                Expert (Play)
                <span class="mode-desc">Start the game immediately (2 Player).<br>நேரடியாக விளையாடத்
                    தொடங்குங்கள்.</span>
            </button>
        </div>
    </div>

    <!-- Instructions Modal -->
    <div id="rules-modal" class="modal-overlay" style="display: none;">
        <div class="modal-card">
            <div class="modal-title">How to Play</div>

            <div class="lang-switch">
                <button class="lang-btn active" onclick="setLang('EN')">English</button>
                <button class="lang-btn" onclick="setLang('TA')">தமிழ்</button>
            </div>

            <div id="rules-content">
                <!-- Content injected via JS -->
            </div>

            <button class="btn" onclick="closeRules()">Got it</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // --- Responsive Canvas Setup ---
        const BASE_WIDTH = 600;
        const BASE_HEIGHT = 500;
        let scale = 1;

        function resizeCanvas() {
            const headerHeight = 60;
            const sidebarWidth = 220; // Width of the sidebar panel
            const padding = 60;

            // Check if we're in mobile layout (vertical stack)
            const isMobile = window.innerWidth <= 768;

            let availableWidth, availableHeight;

            if (isMobile) {
                // Mobile: board stacked on top of panel
                availableWidth = window.innerWidth - padding;
                availableHeight = window.innerHeight - headerHeight - 180 - padding; // Account for panel below
            } else {
                // Desktop: board on left, panel on right
                availableWidth = window.innerWidth - sidebarWidth - padding - 40;
                availableHeight = window.innerHeight - headerHeight - padding;
            }

            // Calculate scale to fit the board - allow scaling up to 1.2x for larger screens
            const scaleW = availableWidth / BASE_WIDTH;
            const scaleH = availableHeight / BASE_HEIGHT;
            scale = Math.min(scaleW, scaleH, 1.3); // Allow up to 1.3x scale for larger screens

            // Set minimum scale for very small screens
            scale = Math.max(scale, 0.6);

            canvas.width = BASE_WIDTH * scale;
            canvas.height = BASE_HEIGHT * scale;

            updatePointPositions();
            draw();
        }

        // --- Board Setup (23 Points) - Base positions at 600x500 ---
        const basePositions = [
            { x: 300, y: 40 },  // 0 - Apex
            { x: 200, y: 130 }, { x: 300, y: 130 }, { x: 400, y: 130 }, // Row 1
            { x: 100, y: 220 }, { x: 200, y: 220 }, { x: 300, y: 220 }, { x: 400, y: 220 }, { x: 500, y: 220 }, // Row 2
            { x: 20, y: 310 }, { x: 113, y: 310 }, { x: 206, y: 310 }, { x: 300, y: 310 }, { x: 394, y: 310 }, { x: 487, y: 310 }, { x: 580, y: 310 }, // Row 3
            { x: 20, y: 400 }, { x: 113, y: 400 }, { x: 206, y: 400 }, { x: 300, y: 400 }, { x: 394, y: 400 }, { x: 487, y: 400 }, { x: 580, y: 400 } // Row 4
        ];

        const P = basePositions.map((pos, i) => ({ x: pos.x, y: pos.y, i }));

        function updatePointPositions() {
            for (let i = 0; i < P.length; i++) {
                P[i].x = basePositions[i].x * scale;
                P[i].y = basePositions[i].y * scale;
            }
        }

        const adj = [
            [1, 2, 3], // 0
            [0, 2, 4, 5], // 1
            [0, 1, 3, 6], // 2
            [0, 2, 7, 8], // 3
            [1, 5, 9, 10], // 4
            [1, 4, 6, 10, 11], // 5
            [2, 5, 7, 12], // 6
            [3, 6, 8, 12, 13], // 7
            [3, 7, 14, 15], // 8
            [4, 10, 16], // 9
            [4, 5, 9, 11, 17], // 10
            [5, 10, 12, 18], // 11
            [6, 7, 11, 13, 19], // 12
            [7, 12, 14, 20], // 13
            [8, 13, 15, 21], // 14
            [8, 14, 22], // 15
            [9, 17], // 16
            [10, 16, 18], // 17
            [11, 17, 19], // 18
            [12, 18, 20], // 19
            [13, 19, 21], // 20
            [14, 20, 22], // 21
            [15, 21] // 22
        ];

        let boardState = Array(23).fill(0);
        let tigersCount = 3;
        let goatsToPlace = 15;
        let deadGoats = 0;
        let turn = 'TIGER';
        let selectedTiger = null;
        let isDemo = false;

        // Rules Content
        const rules = {
            EN: `
                <h3>Goal</h3>
                <p><strong>Goats (Aadu):</strong> Encircle all 3 Tigers so they cannot move.</p>
                <p><strong>Tigers (Puli):</strong> Kill 5 Goats to win.</p>
                <h3>How to Play</h3>
                <ul>
                    <li><strong>Placement:</strong> First, the Goat player places 15 goats one by one on empty spots. Tigers move during this phase too.</li>
                    <li><strong>Movement:</strong> Once all goats are placed, they can move to adjacent empty spots.</li>
                    <li><strong>Tigers:</strong> Can move to adjacent spots OR jump over a goat to kill it (like Checkers).</li>
                </ul>
            `,
            TA: `
                <h3>குறிக்கோள்</h3>
                <p><strong>ஆடுகள்:</strong> 3 புலிகளையும் நகர விடாமல் சுற்றி வளைக்க வேண்டும்.</p>
                <p><strong>புலிகள்:</strong> வெற்றி பெற 5 ஆடுகளை வெட்ட வேண்டும்.</p>
                <h3>விதிமுறைகள்</h3>
                <ul>
                    <li><strong>வைத்தல்:</strong> முதலில், ஆட்டக்காரர் 15 ஆடுகளை ஒவ்வொன்றாக காலி இடங்களில் வைக்க வேண்டும்.</li>
                    <li><strong>நகர்த்தல்:</strong> அனைத்து ஆடுகளும் வைக்கப்பட்ட பிறகு, அவற்றை அடுத்த காலி இடத்திற்கு நகர்த்தலாம்.</li>
                    <li><strong>புலிகள்:</strong> அடுத்த இடத்திற்கு நகரலாம் அல்லது ஆட்டின் மேல் தாண்டி குதித்து அதை வெட்டலாம்.</li>
                </ul>
            `
        };

        function setLang(lang) {
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('rules-content').innerHTML = rules[lang];
        }

        function openRules() {
            document.getElementById('rules-modal').style.display = 'flex';
            setLang('EN'); // Default
        }
        function closeRules() {
            document.getElementById('rules-modal').style.display = 'none';
        }

        function startGame(mode) {
            document.getElementById('start-modal').style.display = 'none';
            resetGame();
            if (mode === 'BEGINNER') {
                runDemo();
            }
        }

        async function runDemo() {
            isDemo = true;
            // 1. Goat places at 4
            await wait(1000);
            boardState[4] = 2; goatsToPlace--; updateUI(); draw();

            // 2. Tiger moves 0 -> 1 (Wait, 0 is blocked? No 0 is Tiger)
            // Initial Tigers at 0, 5, 7.
            // 0 connects to 1, 2, 3. All empty.
            await wait(1000);
            boardState[0] = 0; boardState[1] = 1; updateUI(); draw(); // Tiger moves

            // 3. Goat places at 9 (Safe spot? No, let's place at a spot to be killed for demo)
            // Tiger is at 1. 1 connects to 0, 2, 4, 5.
            // Tiger at 1 can jump over 4 (Goat) to ??? 
            // 1 -> 4 -> ? 
            // 4 connects to 1, 5, 9, 10.
            // 1, 4, 9 are usually collinear.
            // Let's verify jump: 1 -> 4 -> 9?
            // (200,180) -> (100,300) -> (20,420). Yes collinear.

            // So let's place Goat at 4. (Already done).
            // Place Goat at 10 (Safe).
            await wait(1000);
            boardState[10] = 2; goatsToPlace--; updateUI(); draw();

            // 4. Tiger jumps 1 -> 9 (Killing 4)
            await wait(1000);
            // Highlight Tiger
            selectedTiger = 1; draw();
            await wait(500);
            boardState[1] = 0; boardState[4] = 0; boardState[9] = 1; // Jump successful
            deadGoats++;
            selectedTiger = null;
            updateUI(); draw();

            await wait(1000);
            alert("Demo Finished! Now try playing.");
            resetGame();
            isDemo = false;
        }

        function wait(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }

        function resetGame() {
            boardState.fill(0);
            // Initial Tigers
            boardState[0] = 1;
            boardState[5] = 1;
            boardState[7] = 1;

            goatsToPlace = 15;
            deadGoats = 0;
            turn = 'GOAT';
            selectedTiger = null;
            updateUI();
            draw();
        }

        // --- Interaction ---
        canvas.addEventListener('click', e => {
            if (isDemo) return;
            const r = canvas.getBoundingClientRect();
            const scaleX = canvas.width / r.width;
            const scaleY = canvas.height / r.height;
            const mx = (e.clientX - r.left) * scaleX;
            const my = (e.clientY - r.top) * scaleY;

            // Find closest point with scaled hit radius
            const hitRadius = Math.max(20, 30 * scale);
            const hitRadiusSq = hitRadius * hitRadius;
            let clickedIdx = -1;
            for (let i = 0; i < P.length; i++) {
                const dx = mx - P[i].x;
                const dy = my - P[i].y;
                if (dx * dx + dy * dy < hitRadiusSq) {
                    clickedIdx = i;
                    break;
                }
            }
            if (clickedIdx === -1) { selectedTiger = null; draw(); return; }
            handleInput(clickedIdx);
        });

        function handleInput(idx) {
            if (turn === 'GOAT') {
                if (goatsToPlace > 0) {
                    if (boardState[idx] === 0) {
                        boardState[idx] = 2;
                        goatsToPlace--; turn = 'TIGER'; checkWin();
                    }
                } else {
                    if (selectedTiger !== null) {
                        if (boardState[idx] === 0 && isAdjacent(selectedTiger, idx)) {
                            boardState[selectedTiger] = 0; boardState[idx] = 2; selectedTiger = null; turn = 'TIGER'; checkWin();
                        } else if (boardState[idx] === 2) { selectedTiger = idx; }
                    } else { if (boardState[idx] === 2) selectedTiger = idx; }
                }
            } else {
                if (selectedTiger !== null) {
                    if (boardState[idx] === 0) {
                        if (isAdjacent(selectedTiger, idx)) {
                            boardState[selectedTiger] = 0; boardState[idx] = 1; selectedTiger = null; turn = 'GOAT'; checkWin();
                        } else {
                            const killed = getJumpKill(selectedTiger, idx);
                            if (killed !== -1) {
                                boardState[selectedTiger] = 0; boardState[idx] = 1; boardState[killed] = 0; deadGoats++; selectedTiger = null; turn = 'GOAT'; checkWin();
                            }
                        }
                    } else if (boardState[idx] === 1) { selectedTiger = idx; }
                } else { if (boardState[idx] === 1) selectedTiger = idx; }
            }
            updateUI(); draw();
        }

        function isAdjacent(a, b) { return adj[a].includes(b); }
        function getJumpKill(from, to) {
            const neighbors = adj[from];
            for (let mid of neighbors) {
                if (boardState[mid] === 2) {
                    if (adj[mid].includes(to)) {
                        const mx = (P[from].x + P[to].x) / 2;
                        const my = (P[from].y + P[to].y) / 2;
                        if (Math.abs(mx - P[mid].x) < 5 && Math.abs(my - P[mid].y) < 5) { return mid; }
                    }
                }
            }
            return -1;
        }

        function checkWin() {
            if (deadGoats >= 5) { gameOver("Tigers Win!"); return; }
            if (turn === 'TIGER') {
                let canMove = false;
                for (let i = 0; i < 23; i++) {
                    if (boardState[i] === 1) {
                        for (let n of adj[i]) { if (boardState[n] === 0) { canMove = true; break; } }
                        if (!canMove) {
                            for (let n of adj[i]) {
                                if (boardState[n] === 2) {
                                    for (let landing of adj[n]) {
                                        if (landing !== i && boardState[landing] === 0) {
                                            const mx = (P[i].x + P[landing].x) / 2;
                                            const my = (P[i].y + P[landing].y) / 2;
                                            if (Math.abs(mx - P[n].x) < 5 && Math.abs(my - P[n].y) < 5) { canMove = true; break; }
                                        }
                                    }
                                }
                                if (canMove) break;
                            }
                        }
                    }
                    if (canMove) break;
                }
                if (!canMove) { gameOver("Goats Win!"); }
            }
        }
        function gameOver(w) { document.getElementById('game-over-modal').style.display = 'flex'; document.getElementById('winner-text').innerText = w; }

        function updateUI() {
            document.getElementById('goats-count').innerText = goatsToPlace;
            document.getElementById('dead-goats').innerText = deadGoats;
            const ti = document.getElementById('turn-indicator');
            if (turn === 'TIGER') { ti.innerText = "Tiger's Turn"; ti.className = "turn-tiger"; }
            else { ti.innerText = goatsToPlace > 0 ? "Place Goat" : "Move Goat"; ti.className = "turn-goat"; }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Scale line width and sizes based on canvas scale
            const lineWidth = Math.max(2, 4 * scale);
            const pointRadius = Math.max(4, 8 * scale);
            const tigerRadius = Math.max(15, 22 * scale);
            const goatRadius = Math.max(12, 18 * scale);
            const fontSize = Math.max(12, 20 * scale);
            const hitRadius = Math.max(20, 30 * scale);

            ctx.beginPath();
            ctx.strokeStyle = '#94a3b8';
            ctx.lineWidth = lineWidth;
            for (let i = 0; i < P.length; i++) {
                for (let n of adj[i]) {
                    ctx.moveTo(P[i].x, P[i].y);
                    ctx.lineTo(P[n].x, P[n].y);
                }
            }
            ctx.stroke();

            for (let i = 0; i < P.length; i++) {
                const s = boardState[i];
                const x = P[i].x;
                const y = P[i].y;
                ctx.beginPath();
                ctx.fillStyle = '#cbd5e1';
                ctx.arc(x, y, pointRadius, 0, Math.PI * 2);
                ctx.fill();

                if (s === 1) {
                    ctx.beginPath();
                    ctx.fillStyle = '#ea580c';
                    ctx.arc(x, y, tigerRadius, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = 'rgba(0,0,0,0.2)';
                    ctx.font = `${fontSize}px Arial`;
                    ctx.fillText('T', x - fontSize * 0.3, y + fontSize * 0.35);
                    if (selectedTiger === i) {
                        ctx.strokeStyle = '#fff';
                        ctx.lineWidth = 3 * scale;
                        ctx.stroke();
                        ctx.beginPath();
                        ctx.arc(x, y, tigerRadius + 4 * scale, 0, Math.PI * 2);
                        ctx.strokeStyle = '#22c55e';
                        ctx.stroke();
                    }
                } else if (s === 2) {
                    ctx.beginPath();
                    ctx.fillStyle = '#f8fafc';
                    ctx.arc(x, y, goatRadius, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.lineWidth = 2 * scale;
                    ctx.strokeStyle = '#475569';
                    ctx.stroke();
                    if (selectedTiger === i) {
                        ctx.beginPath();
                        ctx.arc(x, y, goatRadius + 4 * scale, 0, Math.PI * 2);
                        ctx.strokeStyle = '#22c55e';
                        ctx.lineWidth = 3 * scale;
                        ctx.stroke();
                    }
                }
            }
        }

        // Initialize with responsive sizing
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

    </script>
</body>

</html>