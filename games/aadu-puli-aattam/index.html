<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aadu Puli Aattam (Goats and Tigers) - Neelakandan</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap');

        :root {
            --color-bg: #f8fafc;
            --color-board: #334155;
            --color-line: #94a3b8;
            --color-tiger: #ea580c;
            --color-goat: #ffffff;
            --color-highlight: #22c55e;
            --font-main: 'Outfit', sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--color-bg);
            font-family: var(--font-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: #1e293b;
        }

        header {
            margin-top: 2rem;
            text-align: center;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: #0f172a;
        }

        p {
            color: #64748b;
        }

        #game-container {
            margin-top: 2rem;
            position: relative;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            overflow: hidden;
            background: var(--color-board);
        }

        canvas {
            display: block;
            cursor: pointer;
        }

        #ui-panel {
            margin-top: 1.5rem;
            display: flex;
            gap: 2rem;
            align-items: center;
            background: white;
            padding: 1rem 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            flex-wrap: wrap;
            justify-content: center;
        }

        .status-box {
            text-align: center;
        }

        .status-label {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #64748b;
            margin-bottom: 0.25rem;
        }

        .status-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: #0f172a;
        }

        #turn-indicator {
            padding: 0.5rem 1rem;
            border-radius: 99px;
            background: #e2e8f0;
            font-weight: 600;
            color: #475569;
        }

        .turn-tiger {
            background: #ffedd5 !important;
            color: #9a3412 !important;
        }

        .turn-goat {
            background: #dcfce7 !important;
            color: #166534 !important;
        }

        .btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid #cbd5e1;
            color: #475569;
        }

        .btn-outline:hover {
            background: #f1f5f9;
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            flex-direction: column;
        }

        .modal-card {
            background: white;
            padding: 2.5rem;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .modal-title {
            font-size: 2rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 1rem;
        }

        .modal-text {
            color: #64748b;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .mode-btn {
            display: block;
            width: 100%;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            position: relative;
        }

        .mode-btn:hover {
            border-color: #3b82f6;
            background: #f8fafc;
        }

        .mode-btn.primary {
            background: #3b82f6;
            border-color: #3b82f6;
            color: white;
        }

        .mode-btn.primary:hover {
            background: #2563eb;
        }

        .mode-desc {
            font-size: 0.85rem;
            font-weight: 400;
            display: block;
            opacity: 0.8;
            margin-top: 0.25rem;
        }

        /* Rules Modal */
        #rules-content {
            text-align: left;
            margin-bottom: 1.5rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .lang-switch {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            justify-content: center;
        }

        .lang-btn {
            padding: 0.25rem 0.75rem;
            font-size: 0.8rem;
            border-radius: 99px;
            border: 1px solid #cbd5e1;
            background: transparent;
            cursor: pointer;
        }

        .lang-btn.active {
            background: #0f172a;
            color: white;
            border-color: #0f172a;
        }

        #game-over-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.9);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 10;
        }

        #winner-text {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
    </style>
</head>

<body>

    <a href="../../index.html" class="btn btn-outline" style="position: absolute; top: 1rem; left: 1rem;">← Back</a>

    <header>
        <h1>Aadu Puli Aattam</h1>
        <p>Goats (Aadu) vs Tigers (Puli) Strategy Game</p>
    </header>

    <div id="game-container">
        <canvas id="gameCanvas" width="600" height="700"></canvas>
        <div id="game-over-modal">
            <div id="winner-text">Goats Win!</div>
            <button class="btn" onclick="resetGame()">Play Again</button>
        </div>
    </div>

    <div id="ui-panel">
        <div class="status-box">
            <div class="status-label">Goats Left</div>
            <div class="status-value" id="goats-count">15</div>
        </div>
        <div class="status-box">
            <div class="status-label">Dead Goats</div>
            <div class="status-value" id="dead-goats">0</div>
        </div>
        <div id="turn-indicator" class="turn-tiger">Tiger's Turn</div>
        <button class="btn btn-outline" onclick="openRules()">Rules / விதிமுறைகள்</button>
        <button class="btn btn-outline" onclick="location.reload()">Exit</button>
    </div>

    <!-- Start Screen Modal -->
    <div id="start-modal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-title">Welcome / வணக்கம்</div>
            <p class="modal-text">Select a mode to begin.<br>விளையாட்டு முறையைத் தேர்ந்தெடுக்கவும்.</p>

            <button class="mode-btn primary" onclick="startGame('BEGINNER')">
                Beginner (Demo)
                <span class="mode-desc">Watch how to play with a short demo.<br>விளையாடுவது எப்படி என்று
                    கற்றுக்கொள்ளுங்கள்.</span>
            </button>

            <button class="mode-btn" onclick="startGame('EXPERT')">
                Expert (Play)
                <span class="mode-desc">Start the game immediately (2 Player).<br>நேரடியாக விளையாடத்
                    தொடங்குங்கள்.</span>
            </button>
        </div>
    </div>

    <!-- Instructions Modal -->
    <div id="rules-modal" class="modal-overlay" style="display: none;">
        <div class="modal-card">
            <div class="modal-title">How to Play</div>

            <div class="lang-switch">
                <button class="lang-btn active" onclick="setLang('EN')">English</button>
                <button class="lang-btn" onclick="setLang('TA')">தமிழ்</button>
            </div>

            <div id="rules-content">
                <!-- Content injected via JS -->
            </div>

            <button class="btn" onclick="closeRules()">Got it</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // --- Board Setup (23 Points) ---
        // S = Start X (Left), Y = Y pos, G = Gap
        const P = [];
        // Row 0 (Apex)
        P.push({ x: 300, y: 60, i: 0 });
        // Row 1 (3 pts)
        P.push({ x: 200, y: 180, i: 1 }, { x: 300, y: 180, i: 2 }, { x: 400, y: 180, i: 3 });
        // Row 2 (5 pts)
        P.push({ x: 100, y: 300, i: 4 }, { x: 200, y: 300, i: 5 }, { x: 300, y: 300, i: 6 }, { x: 400, y: 300, i: 7 }, { x: 500, y: 300, i: 8 });
        // Row 3 (7 pts)
        P.push({ x: 20, y: 420, i: 9 }, { x: 114, y: 420, i: 10 }, { x: 208, y: 420, i: 11 }, { x: 300, y: 420, i: 12 }, { x: 392, y: 420, i: 13 }, { x: 486, y: 420, i: 14 }, { x: 580, y: 420, i: 15 });
        // Row 4 (7 pts) - Bottom Base
        P.push({ x: 20, y: 540, i: 16 }, { x: 114, y: 540, i: 17 }, { x: 208, y: 540, i: 18 }, { x: 300, y: 540, i: 19 }, { x: 392, y: 540, i: 20 }, { x: 486, y: 540, i: 21 }, { x: 580, y: 540, i: 22 });

        const adj = [
            [1, 2, 3], // 0
            [0, 2, 4, 5], // 1
            [0, 1, 3, 6], // 2
            [0, 2, 7, 8], // 3
            [1, 5, 9, 10], // 4
            [1, 4, 6, 10, 11], // 5
            [2, 5, 7, 12], // 6
            [3, 6, 8, 12, 13], // 7
            [3, 7, 14, 15], // 8
            [4, 10, 16], // 9
            [4, 5, 9, 11, 17], // 10
            [5, 10, 12, 18], // 11
            [6, 7, 11, 13, 19], // 12
            [7, 12, 14, 20], // 13
            [8, 13, 15, 21], // 14
            [8, 14, 22], // 15
            [9, 17], // 16
            [10, 16, 18], // 17
            [11, 17, 19], // 18
            [12, 18, 20], // 19
            [13, 19, 21], // 20
            [14, 20, 22], // 21
            [15, 21] // 22
        ];

        let boardState = Array(23).fill(0);
        let tigersCount = 3;
        let goatsToPlace = 15;
        let deadGoats = 0;
        let turn = 'TIGER';
        let selectedTiger = null;
        let isDemo = false;

        // Rules Content
        const rules = {
            EN: `
                <h3>Goal</h3>
                <p><strong>Goats (Aadu):</strong> Encircle all 3 Tigers so they cannot move.</p>
                <p><strong>Tigers (Puli):</strong> Kill 5 Goats to win.</p>
                <h3>How to Play</h3>
                <ul>
                    <li><strong>Placement:</strong> First, the Goat player places 15 goats one by one on empty spots. Tigers move during this phase too.</li>
                    <li><strong>Movement:</strong> Once all goats are placed, they can move to adjacent empty spots.</li>
                    <li><strong>Tigers:</strong> Can move to adjacent spots OR jump over a goat to kill it (like Checkers).</li>
                </ul>
            `,
            TA: `
                <h3>குறிக்கோள்</h3>
                <p><strong>ஆடுகள்:</strong> 3 புலிகளையும் நகர விடாமல் சுற்றி வளைக்க வேண்டும்.</p>
                <p><strong>புலிகள்:</strong> வெற்றி பெற 5 ஆடுகளை வெட்ட வேண்டும்.</p>
                <h3>விதிமுறைகள்</h3>
                <ul>
                    <li><strong>வைத்தல்:</strong> முதலில், ஆட்டக்காரர் 15 ஆடுகளை ஒவ்வொன்றாக காலி இடங்களில் வைக்க வேண்டும்.</li>
                    <li><strong>நகர்த்தல்:</strong> அனைத்து ஆடுகளும் வைக்கப்பட்ட பிறகு, அவற்றை அடுத்த காலி இடத்திற்கு நகர்த்தலாம்.</li>
                    <li><strong>புலிகள்:</strong> அடுத்த இடத்திற்கு நகரலாம் அல்லது ஆட்டின் மேல் தாண்டி குதித்து அதை வெட்டலாம்.</li>
                </ul>
            `
        };

        function setLang(lang) {
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('rules-content').innerHTML = rules[lang];
        }

        function openRules() {
            document.getElementById('rules-modal').style.display = 'flex';
            setLang('EN'); // Default
        }
        function closeRules() {
            document.getElementById('rules-modal').style.display = 'none';
        }

        function startGame(mode) {
            document.getElementById('start-modal').style.display = 'none';
            resetGame();
            if (mode === 'BEGINNER') {
                runDemo();
            }
        }

        async function runDemo() {
            isDemo = true;
            // 1. Goat places at 4
            await wait(1000);
            boardState[4] = 2; goatsToPlace--; updateUI(); draw();

            // 2. Tiger moves 0 -> 1 (Wait, 0 is blocked? No 0 is Tiger)
            // Initial Tigers at 0, 5, 7.
            // 0 connects to 1, 2, 3. All empty.
            await wait(1000);
            boardState[0] = 0; boardState[1] = 1; updateUI(); draw(); // Tiger moves

            // 3. Goat places at 9 (Safe spot? No, let's place at a spot to be killed for demo)
            // Tiger is at 1. 1 connects to 0, 2, 4, 5.
            // Tiger at 1 can jump over 4 (Goat) to ??? 
            // 1 -> 4 -> ? 
            // 4 connects to 1, 5, 9, 10.
            // 1, 4, 9 are usually collinear.
            // Let's verify jump: 1 -> 4 -> 9?
            // (200,180) -> (100,300) -> (20,420). Yes collinear.

            // So let's place Goat at 4. (Already done).
            // Place Goat at 10 (Safe).
            await wait(1000);
            boardState[10] = 2; goatsToPlace--; updateUI(); draw();

            // 4. Tiger jumps 1 -> 9 (Killing 4)
            await wait(1000);
            // Highlight Tiger
            selectedTiger = 1; draw();
            await wait(500);
            boardState[1] = 0; boardState[4] = 0; boardState[9] = 1; // Jump successful
            deadGoats++;
            selectedTiger = null;
            updateUI(); draw();

            await wait(1000);
            alert("Demo Finished! Now try playing.");
            resetGame();
            isDemo = false;
        }

        function wait(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }

        function resetGame() {
            boardState.fill(0);
            // Initial Tigers
            boardState[0] = 1;
            boardState[5] = 1;
            boardState[7] = 1;

            goatsToPlace = 15;
            deadGoats = 0;
            turn = 'GOAT';
            selectedTiger = null;
            updateUI();
            draw();
        }

        // --- Interaction ---
        canvas.addEventListener('click', e => {
            if (isDemo) return;
            const r = canvas.getBoundingClientRect();
            const mx = e.clientX - r.left;
            const my = e.clientY - r.top;

            // Find closest point
            let clickedIdx = -1;
            for (let i = 0; i < P.length; i++) {
                const dx = mx - P[i].x;
                const dy = my - P[i].y;
                if (dx * dx + dy * dy < 900) { // 30px radius
                    clickedIdx = i;
                    break;
                }
            }
            if (clickedIdx === -1) { selectedTiger = null; draw(); return; }
            handleInput(clickedIdx);
        });

        function handleInput(idx) {
            if (turn === 'GOAT') {
                if (goatsToPlace > 0) {
                    if (boardState[idx] === 0) {
                        boardState[idx] = 2;
                        goatsToPlace--; turn = 'TIGER'; checkWin();
                    }
                } else {
                    if (selectedTiger !== null) {
                        if (boardState[idx] === 0 && isAdjacent(selectedTiger, idx)) {
                            boardState[selectedTiger] = 0; boardState[idx] = 2; selectedTiger = null; turn = 'TIGER'; checkWin();
                        } else if (boardState[idx] === 2) { selectedTiger = idx; }
                    } else { if (boardState[idx] === 2) selectedTiger = idx; }
                }
            } else {
                if (selectedTiger !== null) {
                    if (boardState[idx] === 0) {
                        if (isAdjacent(selectedTiger, idx)) {
                            boardState[selectedTiger] = 0; boardState[idx] = 1; selectedTiger = null; turn = 'GOAT'; checkWin();
                        } else {
                            const killed = getJumpKill(selectedTiger, idx);
                            if (killed !== -1) {
                                boardState[selectedTiger] = 0; boardState[idx] = 1; boardState[killed] = 0; deadGoats++; selectedTiger = null; turn = 'GOAT'; checkWin();
                            }
                        }
                    } else if (boardState[idx] === 1) { selectedTiger = idx; }
                } else { if (boardState[idx] === 1) selectedTiger = idx; }
            }
            updateUI(); draw();
        }

        function isAdjacent(a, b) { return adj[a].includes(b); }
        function getJumpKill(from, to) {
            const neighbors = adj[from];
            for (let mid of neighbors) {
                if (boardState[mid] === 2) {
                    if (adj[mid].includes(to)) {
                        const mx = (P[from].x + P[to].x) / 2;
                        const my = (P[from].y + P[to].y) / 2;
                        if (Math.abs(mx - P[mid].x) < 5 && Math.abs(my - P[mid].y) < 5) { return mid; }
                    }
                }
            }
            return -1;
        }

        function checkWin() {
            if (deadGoats >= 5) { gameOver("Tigers Win!"); return; }
            if (turn === 'TIGER') {
                let canMove = false;
                for (let i = 0; i < 23; i++) {
                    if (boardState[i] === 1) {
                        for (let n of adj[i]) { if (boardState[n] === 0) { canMove = true; break; } }
                        if (!canMove) {
                            for (let n of adj[i]) {
                                if (boardState[n] === 2) {
                                    for (let landing of adj[n]) {
                                        if (landing !== i && boardState[landing] === 0) {
                                            const mx = (P[i].x + P[landing].x) / 2;
                                            const my = (P[i].y + P[landing].y) / 2;
                                            if (Math.abs(mx - P[n].x) < 5 && Math.abs(my - P[n].y) < 5) { canMove = true; break; }
                                        }
                                    }
                                }
                                if (canMove) break;
                            }
                        }
                    }
                    if (canMove) break;
                }
                if (!canMove) { gameOver("Goats Win!"); }
            }
        }
        function gameOver(w) { document.getElementById('game-over-modal').style.display = 'flex'; document.getElementById('winner-text').innerText = w; }

        function updateUI() {
            document.getElementById('goats-count').innerText = goatsToPlace;
            document.getElementById('dead-goats').innerText = deadGoats;
            const ti = document.getElementById('turn-indicator');
            if (turn === 'TIGER') { ti.innerText = "Tiger's Turn"; ti.className = "turn-tiger"; }
            else { ti.innerText = goatsToPlace > 0 ? "Place Goat" : "Move Goat"; ti.className = "turn-goat"; }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.beginPath(); ctx.strokeStyle = '#94a3b8'; ctx.lineWidth = 4;
            for (let i = 0; i < P.length; i++) { for (let n of adj[i]) { ctx.moveTo(P[i].x, P[i].y); ctx.lineTo(P[n].x, P[n].y); } }
            ctx.stroke();
            for (let i = 0; i < P.length; i++) {
                const s = boardState[i]; const x = P[i].x; const y = P[i].y;
                ctx.beginPath(); ctx.fillStyle = '#cbd5e1'; ctx.arc(x, y, 8, 0, Math.PI * 2); ctx.fill();
                if (s === 1) {
                    ctx.beginPath(); ctx.fillStyle = '#ea580c'; ctx.arc(x, y, 22, 0, Math.PI * 2); ctx.fill();
                    ctx.fillStyle = 'rgba(0,0,0,0.2)'; ctx.font = '20px Arial'; ctx.fillText('T', x - 6, y + 7);
                    if (selectedTiger === i) { ctx.strokeStyle = '#fff'; ctx.lineWidth = 3; ctx.stroke(); ctx.beginPath(); ctx.arc(x, y, 26, 0, Math.PI * 2); ctx.strokeStyle = '#22c55e'; ctx.stroke(); }
                } else if (s === 2) {
                    ctx.beginPath(); ctx.fillStyle = '#f8fafc'; ctx.arc(x, y, 18, 0, Math.PI * 2); ctx.fill();
                    ctx.lineWidth = 2; ctx.strokeStyle = '#475569'; ctx.stroke();
                    if (selectedTiger === i) { ctx.beginPath(); ctx.arc(x, y, 22, 0, Math.PI * 2); ctx.strokeStyle = '#22c55e'; ctx.lineWidth = 3; ctx.stroke(); }
                }
            }
        }

        draw();

    </script>
</body>

</html>