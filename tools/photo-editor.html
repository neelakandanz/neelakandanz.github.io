<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Image Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 0.9em;
        }

        .editor-wrapper {
            display: flex;
            flex-wrap: wrap;
        }

        .toolbar {
            flex: 0 0 300px;
            background: #f8f9fa;
            padding: 20px;
            border-right: 1px solid #dee2e6;
            max-height: 700px;
            overflow-y: auto;
        }

        .canvas-area {
            flex: 1;
            padding: 30px;
            background: #e9ecef;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 600px;
            position: relative;
        }

        .tool-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #dee2e6;
        }

        .tool-section:last-child {
            border-bottom: none;
        }

        .tool-section h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
        }

        .tool-section h3::before {
            content: '‚óè';
            color: #667eea;
            margin-right: 8px;
            font-size: 1.2em;
        }

        .btn {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        input[type="number"],
        input[type="text"],
        input[type="color"],
        select {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        label {
            display: block;
            margin-top: 10px;
            color: #495057;
            font-weight: 600;
            font-size: 13px;
        }

        #canvas {
            border: 3px solid #495057;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            background: white;
            cursor: crosshair;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        .input-group input {
            flex: 1;
        }

        #fileInput {
            display: none;
        }

        .color-picker-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-preview {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 2px solid #dee2e6;
        }

        .range-group {
            margin: 15px 0;
        }

        .range-group input[type="range"] {
            width: 100%;
            margin-top: 5px;
        }

        .range-value {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 5px;
        }

        @media (max-width: 768px) {
            .toolbar {
                flex: 0 0 100%;
                border-right: none;
                border-bottom: 1px solid #dee2e6;
            }
            
            .canvas-area {
                flex: 0 0 100%;
            }
        }

        .filter-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .filter-btn {
            padding: 8px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® Online Image Editor</h1>
            <p>Create, Edit, and Transform Your Images</p>
        </div>
        
        <div class="editor-wrapper">
            <div class="toolbar">
                <div class="tool-section">
                    <h3>Canvas Setup</h3>
                    <div class="input-group">
                        <div>
                            <label>Width (px)</label>
                            <input type="number" id="canvasWidth" value="800" min="100" max="2000">
                        </div>
                        <div>
                            <label>Height (px)</label>
                            <input type="number" id="canvasHeight" value="600" min="100" max="2000">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="createCanvas()">Create New Canvas</button>
                    
                    <label>Background Color</label>
                    <div class="color-picker-group">
                        <input type="color" id="bgColor" value="#ffffff">
                        <div class="color-preview" id="bgColorPreview" style="background: #ffffff;"></div>
                    </div>
                    <button class="btn btn-secondary" onclick="changeBgColor()">Apply Background</button>
                </div>

                <div class="tool-section">
                    <h3>Image Upload</h3>
                    <input type="file" id="fileInput" accept="image/*" onchange="loadImage(event)">
                    <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                        üìÅ Upload Image
                    </button>
                    
                    <div class="range-group">
                        <label>Image Scale: <span class="range-value" id="scaleValue">100%</span></label>
                        <input type="range" id="imageScale" min="10" max="200" value="100" oninput="updateImageScale()">
                    </div>
                </div>

                <div class="tool-section">
                    <h3>Add Text</h3>
                    <input type="text" id="textInput" placeholder="Enter your text">
                    <label>Font Size</label>
                    <input type="number" id="fontSize" value="30" min="10" max="200">
                    
                    <label>Font Family</label>
                    <select id="fontFamily">
                        <option value="Arial">Arial</option>
                        <option value="Verdana">Verdana</option>
                        <option value="Times New Roman">Times New Roman</option>
                        <option value="Courier New">Courier New</option>
                        <option value="Georgia">Georgia</option>
                        <option value="Comic Sans MS">Comic Sans MS</option>
                    </select>
                    
                    <label>Text Color</label>
                    <input type="color" id="textColor" value="#000000">
                    
                    <button class="btn btn-primary" onclick="addText()">Add Text to Canvas</button>
                </div>

                <div class="tool-section">
                    <h3>Drawing Tools</h3>
                    <label>Brush Size: <span class="range-value" id="brushValue">5px</span></label>
                    <input type="range" id="brushSize" min="1" max="50" value="5" oninput="updateBrushSize()">
                    
                    <label>Brush Color</label>
                    <input type="color" id="brushColor" value="#000000">
                    
                    <button class="btn btn-secondary" onclick="enableDrawing()">‚úèÔ∏è Enable Drawing</button>
                    <button class="btn btn-secondary" onclick="disableDrawing()">üö´ Disable Drawing</button>
                    <button class="btn btn-secondary" onclick="clearCanvas()">üóëÔ∏è Clear Canvas</button>
                </div>

                <div class="tool-section">
                    <h3>Filters</h3>
                    <div class="filter-buttons">
                        <button class="btn btn-secondary filter-btn" onclick="applyFilter('grayscale')">Grayscale</button>
                        <button class="btn btn-secondary filter-btn" onclick="applyFilter('sepia')">Sepia</button>
                        <button class="btn btn-secondary filter-btn" onclick="applyFilter('invert')">Invert</button>
                        <button class="btn btn-secondary filter-btn" onclick="applyFilter('blur')">Blur</button>
                        <button class="btn btn-secondary filter-btn" onclick="applyFilter('brightness')">Brighten</button>
                        <button class="btn btn-secondary filter-btn" onclick="applyFilter('contrast')">Contrast</button>
                    </div>
                    <button class="btn btn-secondary" onclick="resetFilters()">Reset Filters</button>
                </div>

                <div class="tool-section">
                    <h3>Export</h3>
                    <button class="btn btn-success" onclick="downloadImage('png')">‚¨áÔ∏è Download PNG</button>
                    <button class="btn btn-success" onclick="downloadImage('jpg')">‚¨áÔ∏è Download JPG</button>
                </div>
            </div>

            <div class="canvas-area">
                <canvas id="canvas"></canvas>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        let uploadedImage = null;
        let imageScale = 1;
        let imageX = 0;
        let imageY = 0;
        let isDraggingImage = false;
        let isDraggingText = false;
        let dragOffsetX = 0;
        let dragOffsetY = 0;
        let textObjects = [];
        let selectedTextIndex = -1;

        // Initialize canvas
        function createCanvas() {
            const width = parseInt(document.getElementById('canvasWidth').value);
            const height = parseInt(document.getElementById('canvasHeight').value);
            canvas.width = width;
            canvas.height = height;
            ctx.fillStyle = document.getElementById('bgColor').value;
            ctx.fillRect(0, 0, width, height);
            redrawCanvas();
        }

        // Update background color preview
        document.getElementById('bgColor').addEventListener('input', function() {
            document.getElementById('bgColorPreview').style.background = this.value;
        });

        // Change background color
        function changeBgColor() {
            const color = document.getElementById('bgColor').value;
            ctx.fillStyle = color;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            redrawCanvas();
        }

        // Load image
        function loadImage(e) {
            const file = e.target.files[0];
            const reader = new FileReader();
            
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    uploadedImage = img;
                    imageX = (canvas.width - img.width) / 2;
                    imageY = (canvas.height - img.height) / 2;
                    redrawCanvas();
                }
                img.src = event.target.result;
            }
            reader.readAsDataURL(file);
        }

        // Update image scale
        function updateImageScale() {
            if (!uploadedImage) return;
            
            const oldScale = imageScale;
            const newScale = document.getElementById('imageScale').value / 100;
            document.getElementById('scaleValue').textContent = Math.round(newScale * 100) + '%';
            
            // Calculate center point of current image
            const oldWidth = uploadedImage.width * oldScale;
            const oldHeight = uploadedImage.height * oldScale;
            const centerX = imageX + oldWidth / 2;
            const centerY = imageY + oldHeight / 2;
            
            // Update scale
            imageScale = newScale;
            
            // Calculate new position to keep center point the same
            const newWidth = uploadedImage.width * imageScale;
            const newHeight = uploadedImage.height * imageScale;
            imageX = centerX - newWidth / 2;
            imageY = centerY - newHeight / 2;
            
            redrawCanvas();
        }

        // Redraw canvas with image
        function redrawCanvas() {
            ctx.fillStyle = document.getElementById('bgColor').value;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            if (uploadedImage) {
                const scaledWidth = uploadedImage.width * imageScale;
                const scaledHeight = uploadedImage.height * imageScale;
                ctx.drawImage(uploadedImage, imageX, imageY, scaledWidth, scaledHeight);
            }
            
            // Redraw all text objects
            textObjects.forEach((textObj, index) => {
                ctx.font = `${textObj.fontSize}px ${textObj.fontFamily}`;
                ctx.fillStyle = textObj.color;
                ctx.fillText(textObj.text, textObj.x, textObj.y);
                
                // Highlight selected text
                if (index === selectedTextIndex) {
                    ctx.strokeStyle = '#667eea';
                    ctx.lineWidth = 2;
                    const metrics = ctx.measureText(textObj.text);
                    ctx.strokeRect(textObj.x - 5, textObj.y - textObj.fontSize, metrics.width + 10, textObj.fontSize + 10);
                }
            });
        }

        // Add text
        function addText() {
            const text = document.getElementById('textInput').value;
            const fontSize = parseInt(document.getElementById('fontSize').value);
            const fontFamily = document.getElementById('fontFamily').value;
            const color = document.getElementById('textColor').value;
            
            if (text) {
                const textObj = {
                    text: text,
                    x: 50,
                    y: canvas.height / 2,
                    fontSize: fontSize,
                    fontFamily: fontFamily,
                    color: color
                };
                textObjects.push(textObj);
                redrawCanvas();
                document.getElementById('textInput').value = '';
            }
        }

        // Drawing functionality
        let drawing = false;

        function enableDrawing() {
            drawing = true;
            canvas.style.cursor = 'crosshair';
        }

        function disableDrawing() {
            drawing = false;
            canvas.style.cursor = 'default';
        }

        function updateBrushSize() {
            const size = document.getElementById('brushSize').value;
            document.getElementById('brushValue').textContent = size + 'px';
        }

        canvas.addEventListener('mousedown', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Check if clicking on text
            selectedTextIndex = -1;
            for (let i = textObjects.length - 1; i >= 0; i--) {
                const textObj = textObjects[i];
                ctx.font = `${textObj.fontSize}px ${textObj.fontFamily}`;
                const metrics = ctx.measureText(textObj.text);
                
                if (x >= textObj.x - 5 && x <= textObj.x + metrics.width + 5 &&
                    y >= textObj.y - textObj.fontSize && y <= textObj.y + 10) {
                    isDraggingText = true;
                    selectedTextIndex = i;
                    dragOffsetX = x - textObj.x;
                    dragOffsetY = y - textObj.y;
                    canvas.style.cursor = 'move';
                    redrawCanvas();
                    return;
                }
            }
            
            // Check if clicking on image
            if (uploadedImage) {
                const scaledWidth = uploadedImage.width * imageScale;
                const scaledHeight = uploadedImage.height * imageScale;
                
                if (x >= imageX && x <= imageX + scaledWidth &&
                    y >= imageY && y <= imageY + scaledHeight) {
                    isDraggingImage = true;
                    dragOffsetX = x - imageX;
                    dragOffsetY = y - imageY;
                    canvas.style.cursor = 'move';
                    return;
                }
            }
            
            // Drawing mode
            if (drawing) {
                isDrawing = true;
                ctx.beginPath();
                ctx.moveTo(x, y);
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Drag image
            if (isDraggingImage) {
                imageX = x - dragOffsetX;
                imageY = y - dragOffsetY;
                redrawCanvas();
                return;
            }
            
            // Drag text
            if (isDraggingText && selectedTextIndex !== -1) {
                textObjects[selectedTextIndex].x = x - dragOffsetX;
                textObjects[selectedTextIndex].y = y - dragOffsetY;
                redrawCanvas();
                return;
            }
            
            // Drawing
            if (isDrawing && drawing) {
                const size = document.getElementById('brushSize').value;
                const color = document.getElementById('brushColor').value;
                
                ctx.lineWidth = size;
                ctx.lineCap = 'round';
                ctx.strokeStyle = color;
                ctx.lineTo(x, y);
                ctx.stroke();
            }
            
            // Update cursor
            if (!drawing) {
                let overObject = false;
                
                // Check text hover
                for (let i = textObjects.length - 1; i >= 0; i--) {
                    const textObj = textObjects[i];
                    ctx.font = `${textObj.fontSize}px ${textObj.fontFamily}`;
                    const metrics = ctx.measureText(textObj.text);
                    
                    if (x >= textObj.x - 5 && x <= textObj.x + metrics.width + 5 &&
                        y >= textObj.y - textObj.fontSize && y <= textObj.y + 10) {
                        overObject = true;
                        break;
                    }
                }
                
                // Check image hover
                if (!overObject && uploadedImage) {
                    const scaledWidth = uploadedImage.width * imageScale;
                    const scaledHeight = uploadedImage.height * imageScale;
                    
                    if (x >= imageX && x <= imageX + scaledWidth &&
                        y >= imageY && y <= imageY + scaledHeight) {
                        overObject = true;
                    }
                }
                
                canvas.style.cursor = overObject ? 'move' : 'default';
            }
        });

        canvas.addEventListener('mouseup', () => {
            isDrawing = false;
            isDraggingImage = false;
            isDraggingText = false;
            if (!drawing) {
                canvas.style.cursor = 'default';
            }
        });

        canvas.addEventListener('mouseout', () => {
            isDrawing = false;
            isDraggingImage = false;
            isDraggingText = false;
        });

        // Clear canvas
        function clearCanvas() {
            ctx.fillStyle = document.getElementById('bgColor').value;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            uploadedImage = null;
            textObjects = [];
            selectedTextIndex = -1;
        }

        // Apply filters
        function applyFilter(filterType) {
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            for (let i = 0; i < data.length; i += 4) {
                switch(filterType) {
                    case 'grayscale':
                        const gray = 0.299 * data[i] + 0.587 * data[i + 1] + 0.114 * data[i + 2];
                        data[i] = data[i + 1] = data[i + 2] = gray;
                        break;
                    case 'sepia':
                        const r = data[i], g = data[i + 1], b = data[i + 2];
                        data[i] = Math.min(255, r * 0.393 + g * 0.769 + b * 0.189);
                        data[i + 1] = Math.min(255, r * 0.349 + g * 0.686 + b * 0.168);
                        data[i + 2] = Math.min(255, r * 0.272 + g * 0.534 + b * 0.131);
                        break;
                    case 'invert':
                        data[i] = 255 - data[i];
                        data[i + 1] = 255 - data[i + 1];
                        data[i + 2] = 255 - data[i + 2];
                        break;
                    case 'brightness':
                        data[i] = Math.min(255, data[i] + 30);
                        data[i + 1] = Math.min(255, data[i + 1] + 30);
                        data[i + 2] = Math.min(255, data[i + 2] + 30);
                        break;
                    case 'contrast':
                        const factor = 1.5;
                        data[i] = Math.min(255, ((data[i] - 128) * factor) + 128);
                        data[i + 1] = Math.min(255, ((data[i + 1] - 128) * factor) + 128);
                        data[i + 2] = Math.min(255, ((data[i + 2] - 128) * factor) + 128);
                        break;
                    case 'blur':
                        // Simple blur effect
                        if (i > 0 && i < data.length - 4) {
                            data[i] = (data[i] + data[i - 4] + data[i + 4]) / 3;
                            data[i + 1] = (data[i + 1] + data[i - 3] + data[i + 5]) / 3;
                            data[i + 2] = (data[i + 2] + data[i - 2] + data[i + 6]) / 3;
                        }
                        break;
                }
            }
            ctx.putImageData(imageData, 0, 0);
        }

        function resetFilters() {
            redrawCanvas();
        }

        // Download image
        function downloadImage(format) {
            const link = document.createElement('a');
            const mimeType = format === 'png' ? 'image/png' : 'image/jpeg';
            link.download = `edited-image.${format}`;
            link.href = canvas.toDataURL(mimeType);
            link.click();
        }

        // Initialize on load
        window.onload = function() {
            createCanvas();
        }
    </script>
</body>
</html>
