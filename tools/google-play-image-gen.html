<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Play Asset Generator</title>
    <link rel="stylesheet" href="google-play-image-gen-style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ú® Google Play Asset Generator</h1>
            <p>Generate App Icon, Feature Graphic, and Screenshots to spec.</p>
        </div>
        
        <div class="content-wrapper">
            <a href="../index.html" class="btn btn-primary back-button">‚Üê Back to Tools</a>

            <div class="file-input-group">
                <h2 class="section-title">1. Upload Your Source Image</h2>
                <p>Upload a high-resolution image to be used as the source for all assets.</p>
                <input type="file" id="fileInput" accept="image/png, image/jpeg" onchange="handleImageUpload(event)">
                <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                    üìÅ Select Image
                </button>
            </div>
            
            <div id="preview-container">
                <img id="source-image-preview" style="display: none;" alt="Source Image Preview">
            </div>

            <h2 class="section-title">2. Generated Assets</h2>
            <div id="output-section" class="output-grid" style="display: none;">
                
                <div class="output-card">
                    <h3>App Icon</h3>
                    <p>Required Size: 512px x 512px</p>
                    <canvas id="canvasIcon" width="512" height="512"></canvas>
                    <button class="btn btn-download" onclick="downloadCanvas('canvasIcon', 'app-icon', 'png')" disabled>
                        ‚¨áÔ∏è Download PNG
                    </button>
                </div>

                <div class="output-card">
                    <h3>Feature Graphic</h3>
                    <p>Required Size: 1024px x 500px</p>
                    <canvas id="canvasFeature" width="1024" height="500"></canvas>
                    <button class="btn btn-download" onclick="downloadCanvas('canvasFeature', 'feature-graphic', 'jpeg')" disabled>
                        ‚¨áÔ∏è Download JPG
                    </button>
                </div>

                <div class="output-card">
                    <h3>Screenshot (Landscape)</h3>
                    <p>Aspect Ratio: 16:9 (e.g., 1280px x 720px)</p>
                    <canvas id="canvasScreenshotL" width="1280" height="720"></canvas>
                    <button class="btn btn-download" onclick="downloadCanvas('canvasScreenshotL', 'screenshot-landscape', 'jpeg')" disabled>
                        ‚¨áÔ∏è Download JPG
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let sourceImage = null;
        const outputSection = document.getElementById('output-section');
        const previewImage = document.getElementById('source-image-preview');
        const downloadButtons = document.querySelectorAll('.btn-download');

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    sourceImage = img;
                    previewImage.src = e.target.result;
                    previewImage.style.display = 'block';
                    outputSection.style.display = 'grid';
                    redrawAllCanvases();
                    downloadButtons.forEach(btn => btn.disabled = false);
                }
                img.src = e.target.result;
            }
            reader.readAsDataURL(file);
        }

        function redrawAllCanvases() {
            if (!sourceImage) return;

            // 1. App Icon (512x512)
            resizeAndDraw('canvasIcon', 512, 512, sourceImage);

            // 2. Feature Graphic (1024x500)
            resizeAndDraw('canvasFeature', 1024, 500, sourceImage);

            // 3. Phone Screenshot (16:9 Landscape - 1280x720)
            resizeAndDraw('canvasScreenshotL', 1280, 720, sourceImage);
        }

        /**
         * Resizes and draws the source image onto a target canvas using a "cover" fit.
         * The image is centered and scaled to cover the entire canvas area without stretching.
         */
        function resizeAndDraw(canvasId, targetWidth, targetHeight, img) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            
            // Clear canvas and fill with white background
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, targetWidth, targetHeight);

            const imgRatio = img.width / img.height;
            const canvasRatio = targetWidth / targetHeight;

            let drawWidth, drawHeight, offsetX, offsetY;

            if (imgRatio > canvasRatio) {
                // Image is wider than canvas (in relation to height), scale by height
                drawHeight = targetHeight;
                drawWidth = drawHeight * imgRatio;
                offsetX = (targetWidth - drawWidth) / 2;
                offsetY = 0;
            } else {
                // Image is taller than canvas, scale by width
                drawWidth = targetWidth;
                drawHeight = drawWidth / imgRatio;
                offsetX = 0;
                offsetY = (targetHeight - drawHeight) / 2;
            }

            // Draw the image, covering the canvas
            ctx.drawImage(img, offsetX, offsetY, drawWidth, drawHeight);
        }

        function downloadCanvas(canvasId, filename, format) {
            const canvas = document.getElementById(canvasId);
            let mimeType = format === 'png' ? 'image/png' : 'image/jpeg';
            let quality = format === 'jpeg' ? 0.9 : 1.0; // Set quality for JPG

            const link = document.createElement('a');
            link.download = `${filename}.${format}`;
            link.href = canvas.toDataURL(mimeType, quality);
            link.click();
        }

        window.onload = function() {
            // Initial call to ensure canvases are ready
            redrawAllCanvases();
        }
    </script>
</body>
</html>