<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Play Asset Generator</title>
    <link rel="stylesheet" href="google-play-image-gen-style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        /* New style for the input grid */
        .input-asset-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .input-asset-grid .file-input-group h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: #1f2937;
        }
        .input-asset-grid .file-input-group {
            padding: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ú® Google Play Asset Generator</h1>
            <p>Generate App Icon, Feature Graphic, and Screenshots to spec.</p>
        </div>
        
        <div class="content-wrapper">
            <a href="../index.html" class="btn btn-primary back-button">‚Üê Back to Tools</a>

            <h2 class="section-title">1. Upload Source Images</h2>
            
            <div class="input-asset-grid">
                <div class="file-input-group">
                    <h3>App Icon Source (512x512)</h3>
                    <p style="font-size: 0.8rem; margin-top: 5px; margin-bottom: 10px;">A high-res square image is recommended.</p>
                    <input type="file" id="fileInputIcon" accept="image/png, image/jpeg" onchange="handleImageUpload(event, 'icon')">
                    <button class="btn btn-primary" onclick="document.getElementById('fileInputIcon').click()">
                        <span id="icon-status">üìÅ Select Image</span>
                    </button>
                </div>

                <div class="file-input-group">
                    <h3>Feature Graphic Source (1024x500)</h3>
                    <p style="font-size: 0.8rem; margin-top: 5px; margin-bottom: 10px;">A high-res landscape image is recommended.</p>
                    <input type="file" id="fileInputFeature" accept="image/png, image/jpeg" onchange="handleImageUpload(event, 'feature')">
                    <button class="btn btn-primary" onclick="document.getElementById('fileInputFeature').click()">
                        <span id="feature-status">üìÅ Select Image</span>
                    </button>
                </div>

                <div class="file-input-group">
                    <h3>Screenshot Template (1280x720)</h3>
                    <p style="font-size: 0.8rem; margin-top: 5px; margin-bottom: 10px;">A high-res landscape image is recommended.</p>
                    <input type="file" id="fileInputScreenshot" accept="image/png, image/jpeg" onchange="handleImageUpload(event, 'screenshot')">
                    <button class="btn btn-primary" onclick="document.getElementById('fileInputScreenshot').click()">
                        <span id="screenshot-status">üìÅ Select Image</span>
                    </button>
                </div>
            </div>
            
            <h2 class="section-title">2. Generated Assets</h2>
            <div id="output-section" class="output-grid" style="display: none;">
                
                <div class="output-card">
                    <h3>App Icon</h3>
                    <p>Required Size: 512px x 512px</p>
                    <canvas id="canvasIcon" width="512" height="512"></canvas>
                    <button class="btn btn-download" onclick="downloadCanvas('canvasIcon', 'app-icon', 'png')" disabled>
                        ‚¨áÔ∏è Download PNG
                    </button>
                </div>

                <div class="output-card">
                    <h3>Feature Graphic</h3>
                    <p>Required Size: 1024px x 500px</p>
                    <label for="scaleFeature" style="display: block; text-align: left; margin: 10px 0 5px; font-size: 0.9rem;">Scale: <span id="scaleValueFeature">100%</span></label>
                    <input type="range" id="scaleFeature" min="50" max="200" value="100" oninput="updateScale('Feature');" style="width: 100%; margin-bottom: 15px;">
                    <canvas id="canvasFeature" width="1024" height="500"></canvas>
                    <button class="btn btn-download" onclick="downloadCanvas('canvasFeature', 'feature-graphic', 'jpeg')" disabled>
                        ‚¨áÔ∏è Download JPG
                    </button>
                </div>

                <div class="output-card">
                    <h3>Screenshot (Landscape)</h3>
                    <p>Aspect Ratio: 16:9 (e.g., 1280px x 720px)</p>
                    <label for="scaleScreenshotL" style="display: block; text-align: left; margin: 10px 0 5px; font-size: 0.9rem;">Scale: <span id="scaleValueScreenshotL">100%</span></label>
                    <input type="range" id="scaleScreenshotL" min="50" max="200" value="100" oninput="updateScale('ScreenshotL');" style="width: 100%; margin-bottom: 15px;">
                    <canvas id="canvasScreenshotL" width="1280" height="720"></canvas>
                    <button class="btn btn-download" onclick="downloadCanvas('canvasScreenshotL', 'screenshot-landscape', 'jpeg')" disabled>
                        ‚¨áÔ∏è Download JPG
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // New object to hold separate source images
        let sourceImages = {
            icon: null,
            feature: null,
            screenshot: null
        };
        const outputSection = document.getElementById('output-section');
        const downloadButtons = document.querySelectorAll('.btn-download');

        // STATE VARIABLES
        let scaleFeature = 1.0;
        let scaleScreenshotL = 1.0;
        // END STATE VARIABLES

        // Modified function to handle upload for a specific asset type
        function handleImageUpload(event, assetType) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    // Store image in the correct asset slot
                    sourceImages[assetType] = img;
                    
                    // Update status button text
                    const statusEl = document.getElementById(assetType + '-status');
                    statusEl.textContent = `‚úÖ ${assetType.charAt(0).toUpperCase() + assetType.slice(1)} Loaded`;

                    outputSection.style.display = 'grid'; // Make sure outputs are visible
                    downloadButtons.forEach(btn => btn.disabled = false);
                    
                    redrawAllCanvases();
                }
                img.src = e.target.result;
            }
            reader.readAsDataURL(file);
        }

        function updateScale(assetType) {
            const slider = document.getElementById('scale' + assetType);
            const valueSpan = document.getElementById('scaleValue' + assetType);
            const newScale = parseInt(slider.value) / 100;

            if (assetType === 'Feature') {
                scaleFeature = newScale;
            } else if (assetType === 'ScreenshotL') {
                scaleScreenshotL = newScale;
            }

            valueSpan.textContent = slider.value + '%';
            redrawAllCanvases();
        }

        // Modified redraw function to use specific source images
        function redrawAllCanvases() {
            // 1. App Icon (512x512) - Uses 'cover' logic
            if (sourceImages.icon) {
                resizeAndDrawCover('canvasIcon', 512, 512, sourceImages.icon);
            }
            // 2. Feature Graphic (1024x500) - Uses 'scaled' logic
            if (sourceImages.feature) {
                resizeAndDrawScaled('canvasFeature', 1024, 500, sourceImages.feature, scaleFeature);
            }
            // 3. Phone Screenshot (16:9 Landscape - 1280x720) - Uses 'scaled' logic
            if (sourceImages.screenshot) {
                resizeAndDrawScaled('canvasScreenshotL', 1280, 720, sourceImages.screenshot, scaleScreenshotL);
            }
        }

        /**
         * Resizes and draws the source image onto a target canvas using a "cover" fit.
         * Used for App Icon where image must fill the entire canvas.
         */
        function resizeAndDrawCover(canvasId, targetWidth, targetHeight, img) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            
            // Clear canvas and fill with white background
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, targetWidth, targetHeight);

            const imgRatio = img.width / img.height;
            const canvasRatio = targetWidth / targetHeight;

            let drawWidth, drawHeight, offsetX, offsetY;

            if (imgRatio > canvasRatio) {
                // Image is wider than canvas (in relation to height), scale by height
                drawHeight = targetHeight;
                drawWidth = drawHeight * imgRatio;
                offsetX = (targetWidth - drawWidth) / 2;
                offsetY = 0;
            } else {
                // Image is taller than canvas, scale by width
                drawWidth = targetWidth;
                drawHeight = drawWidth / imgRatio;
                offsetX = 0;
                offsetY = (targetHeight - drawHeight) / 2;
            }

            // Draw the image, covering the canvas
            ctx.drawImage(img, offsetX, offsetY, drawWidth, drawHeight);
        }

        /**
         * Resizes and draws the source image onto a target canvas using a "contain" fit
         * then applies a user-defined scale factor for zoom.
         */
        function resizeAndDrawScaled(canvasId, targetWidth, targetHeight, img, scaleFactor) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            
            // Clear canvas and fill with white background
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, targetWidth, targetHeight);

            // 1. Calculate max size for "contain" fit (base size)
            const imgRatio = img.width / img.height;
            
            let maxDrawWidth, maxDrawHeight;

            if (img.width / targetWidth > img.height / targetHeight) {
                // Image is constrained by canvas width
                maxDrawWidth = targetWidth;
                maxDrawHeight = targetWidth / imgRatio;
            } else {
                // Image is constrained by canvas height
                maxDrawHeight = targetHeight;
                maxDrawWidth = targetHeight * imgRatio;
            }
            
            // 2. Apply user scale factor
            const drawWidth = maxDrawWidth * scaleFactor;
            const drawHeight = maxDrawHeight * scaleFactor;

            // 3. Calculate centering offsets
            const offsetX = (targetWidth - drawWidth) / 2;
            const offsetY = (targetHeight - drawHeight) / 2;

            // 4. Draw the image
            ctx.drawImage(img, offsetX, offsetY, drawWidth, drawHeight);
        }

        function downloadCanvas(canvasId, filename, format) {
            const canvas = document.getElementById(canvasId);
            let mimeType = format === 'png' ? 'image/png' : 'image/jpeg';
            let quality = format === 'jpeg' ? 0.9 : 1.0; // Set quality for JPG

            const link = document.createElement('a');
            link.download = `${filename}.${format}`;
            link.href = canvas.toDataURL(mimeType, quality);
            link.click();
        }

        window.onload = function() {
            // Initializing canvases is handled by attributes. The redraw logic relies on uploads.
        }
    </script>
</body>
</html>